SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[опер_и] (@опер_код          INT,
                                @ном_код           INT,
                                @дата_зае          DATETIME,
                                @кли_код           INT,
                                @счет_код          INT,
                                @дата_вые          DATETIME,
                                @дата_вые_факт     DATETIME,
                                @сут               NUMERIC(4, 1),
                                @сут_дни           INT,
                                @пол_сут_зае       BIT,
                                @пол_сут_вые       BIT,
                                @кол_взр           INT,
                                @кол_дет           INT,
                                @рег               INT,
                                @тип_зае_код       INT,
                                @цель_код          INT,
                                @ски_код           INT,
                                @ски_про           INT,
                                @цена              BIGINT,
                                @цена_изм          BIT,
                                @инф_зае           TEXT,
                                @инф_вые           TEXT,
                                @раб_место         CHAR(30),
                                @раб_должность     CHAR(30),
                                @раб_ком_уд        CHAR(30),
                                @раб_прибыл        CHAR(30),
                                @виза_вид_код      INT,
                                @виза_сер          CHAR(3),
                                @виза_номер        CHAR(30),
                                @виза_дата_с       DATE,
                                @виза_дата_по      DATE,
                                @страх_кем_код     INT,
                                @страх_номер       CHAR(30),
                                @страх_дата_с      DATE,
                                @страх_дата_по     DATE,
                                @миг_карта         CHAR(30),
                                @миг_карта_дата_с  DATE,
                                @миг_карта_дата_по DATE,
                                @гра_дата          DATE,
                                @гра_код           INT)
AS
  SET NOCOUNT OFF;

  SELECT
    @раб_место = раб_место,
    @раб_должность = раб_должность,
    @раб_ком_уд = раб_ком_уд,
    @раб_прибыл = раб_прибыл,
    @рег = рег,
    @виза_вид_код = виза_вид_код,
    @виза_сер = виза_сер,
    @виза_номер = виза_номер,
    @виза_дата_с = виза_дата_с,
    @виза_дата_по = виза_дата_по,
    @страх_кем_код = страх_кем_код,
    @страх_номер = страх_номер,
    @страх_дата_с = страх_дата_с,
    @страх_дата_по = страх_дата_по,
    @миг_карта = миг_карта,
    @миг_карта_дата_с = миг_карта_дата_с,
    @миг_карта_дата_по = миг_карта_дата_по,
    @гра_дата = гра_дата,
    @гра_код = гра_код
  FROM
    кли
  WHERE  кли.кли_код = @кли_код

  UPDATE [опер]
  SET    [ном_код] = @ном_код,
         [дата_зае] = @дата_зае,
         [кли_код] = @кли_код,
         [счет_код] = @счет_код,
         [дата_вые] = @дата_вые,
         [дата_вые_факт] = @дата_вые_факт,
         [сут] = @сут,
         [сут_дни] = @сут_дни,
         [пол_сут_зае] = @пол_сут_зае,
         [пол_сут_вые] = @пол_сут_вые,
         [кол_взр] = @кол_взр,
         [кол_дет] = @кол_дет,
         [рег] = @рег,
         [тип_зае_код] = @тип_зае_код,
         [цель_код] = @цель_код,
         [ски_код] = @ски_код,
         [ски_про] = @ски_про,
         [цена] = @цена,
         [цена_изм] = @цена_изм,
         [инф_зае] = @инф_зае,
         [инф_вые] = @инф_вые,
         [раб_место] = @раб_место,
         [раб_должность] = @раб_должность,
         [раб_ком_уд] = @раб_ком_уд,
         [раб_прибыл] = @раб_прибыл,
         [виза_вид_код] = @виза_вид_код,
         [виза_сер] = @виза_сер,
         [виза_номер] = @виза_номер,
         [виза_дата_с] = @виза_дата_с,
         [виза_дата_по] = @виза_дата_по,
         [страх_кем_код] = @страх_кем_код,
         [страх_номер] = @страх_номер,
         [страх_дата_с] = @страх_дата_с,
         [страх_дата_по] = @страх_дата_по,
         [миг_карта] = @миг_карта,
         [миг_карта_дата_с] = @миг_карта_дата_с,
         [миг_карта_дата_по] = @миг_карта_дата_по,
         [гра_дата] = @гра_дата,
         [гра_код] = @гра_код
  WHERE  ( [опер_код] = @опер_код );

  SELECT
    опер_код,
    ном_код,
    дата_зае,
    кли_код,
    счет_код,
    дата_вые,
    дата_вые_факт,
    сут,
   
    Isnull(пол_сут_зае, 0) AS пол_сут_зае,
    Isnull(пол_сут_вые, 0) AS пол_сут_вые,
    
    Isnull(сут_дни, 0) AS сут_дни,
    кол_взр,
    кол_дет,
    рег,
    тип_зае_код,
    цель_код,
    ски_код,
    ски_про,
    цена,
    цена_изм,
    инф_зае,
    инф_вые,
    раб_место,
    раб_должность,
    раб_ком_уд,
    раб_прибыл,
    виза_вид_код,
    виза_сер,
    виза_номер,
    виза_дата_с,
    виза_дата_по,
    страх_кем_код,
    страх_номер,
    страх_дата_с,
    страх_дата_по,
    миг_карта,
    миг_карта_дата_с,
    миг_карта_дата_по,
    гра_дата,
    гра_код
  FROM
    опер
  WHERE  ( опер_код = @опер_код )
GO